(function(FS) { var session = FS.getCurrentSession(), sessionUrl = FS.getCurrentSessionURL(); function retryWithBackoff(condition, callback, maxWait, failureMsg) { var totalTimeExpired = 0; var wait = 64; var resultFn = function() { if (condition()) {
callback(); return; } wait = Math.min(wait * 2, 1024); if (totalTimeExpired > maxWait) { FS.log('warn', failureMsg); return; } totalTimeExpired += wait setTimeout(resultFn, wait); }; return resultFn; } function loadSession(key) { var lastSession = window['localStorage'].getItem(key);
if (!lastSession) { lastSession = FS._cookies()[key]; } return lastSession } function saveSession(key, session) { window['localStorage'].setItem(key, session); } function intercomOnPage() { return window['Intercom'] && typeof(Intercom)=="function"; }
function intercomBooted() { return document.querySelector(".intercom-app, .intercom-lightweight-app"); } function fsIntercomInit() { var lastSession = loadSession('fs_intercom'); if (session != lastSession) { saveSession('fs_intercom', session); var fsMetadata
= { "Session Link": { value: "Play in FullStory", url: sessionUrl }, "Session Time": (new Date()).toUTCString() }; Intercom('trackEvent', 'New FullStory Session', fsMetadata); retryWithBackoff(intercomBooted, intercomUpdateAttrAsync, 8000, 'The FullStory
integration with Intercom loaded, but did not detect that Intercom booted successfully.')(); } } retryWithBackoff(intercomOnPage, fsIntercomInit, 30000, 'The FullStory integration with Intercom is enabled, but FullStory could not find Intercom on the
page.')(); function intercomUpdateAttrAsync() { Intercom('update', {'Latest FullStory Session': sessionUrl}); }; })(window['_fs_namespace'] ? window[window['_fs_namespace']] : window['FS'])